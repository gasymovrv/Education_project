# Базы данных

### Транзакции и ACID

#### Atomicity — Атомарность
+ Должны быть выполнены либо все её подоперации, либо не выполнено ни одной

#### Consistency — Согласованность
+ Каждая успешная транзакция по определению фиксирует только допустимые результаты
+ Пример не согласованности данных - отрицательный возраст, отрицательный баланс на счете

#### Isolation — Изолированность
+ Во время выполнения транзакции параллельные транзакции не должны оказывать влияния на её результат
+ Проблемы плохой изолированности (параллельного доступа, где 1 - 1ая транзакция, 2 - 2ая):
	+ Потерянное обновление (1:update(+=) + 2:update(+=))
	+ «Грязное» чтение (1:update/insert + 2:select + 1:rollback)
	+ Неповторяющееся чтение (1:select + 2:update/delete + 1:select)
	+ Чтение «фантомов» (1:select + 2:insert + 1:select)
	
	+ Решения этих проблем специальными [уровнями изоляции в БД](https://ru.wikipedia.org/wiki/%D0%A3%D1%80%D0%BE%D0%B2%D0%B5%D0%BD%D1%8C_%D0%B8%D0%B7%D0%BE%D0%BB%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8_%D1%82%D1%80%D0%B0%D0%BD%D0%B7%D0%B0%D0%BA%D1%86%D0%B8%D0%B9):

        | Уровень изоляции | Фантомное чтение | Неповторяющееся чтение | «Грязное» чтение | Потерянное обновление |
        |:----------------:|:----------------:|:----------------------:|:----------------:|:---------------------:|
        | READ UNCOMMITTED |         -        |            -           |         -        |           +           |
        |  READ COMMITTED  |         -        |            -           |         +        |           +           |
        |  REPEATABLE READ |         -        |            +           |         +        |           +           |
        |   SERIALIZABLE   |         +        |            +           |         +        |           +           |
        
#### Durability — Стойкость
+ Изменения, сделанные успешно завершённой транзакцией, должны остаться сохранёнными после возвращения системы в работу

### Теорема CAP
+ Утверждение о том, что в любой реализации распределённых вычислений возможно обеспечить не более двух из трёх следующих свойств:
    + согласованность (consistency) — во всех вычислительных узлах в один момент времени данные не противоречат друг другу;
    + доступность (availability) — любой запрос к распределённой системе завершается корректным откликом, однако без гарантии, что ответы всех узлов системы совпадают;
    + устойчивость к разрывам сети (partition tolerance) — устойчивость к распределению. Даже если между узлами нет связи, они продолжают работать независимо друг от друга.
+ Подробнее [тут](https://habr.com/ru/post/328792/)

### SQL 
+ select
+ insert
+ update
+ delete
+ join (inner, outer left, outer right)
+ union
+ Группировка по месяцам из дат (для postgres функция EXTRACT)
+ Решения задач с http://sql-ex.ru
    + [src/main/resources/db](/src/main/resources/db)

### Сравнение NoSQL с SQL
+ SQL (Structured Query Language) — универсальный язык запросов, который используется всеми реляционными системами.
+ NoSQL имеют собственный API для взаимодействия.
+ Преимущества РСУБД — соответствия базы данных требованиям ACID, целостность данных, структурированность.
+ Преимущества NoSQL — скорость обработки данных, масштабируемость, распределенность систем.
+ Подробнее [тут](https://habr.com/ru/sandbox/113232/)

### NoSQL СУБД
+ Подробнее [тут](https://habr.com/ru/company/oleg-bunin/blog/319052/)

#### Типы NoSql СУБД
+ Key/value хранилища
    + Хранение в виде ассоциативного массива. Минимальный интерфейс для такой базы данных состоит всего из 3-х операций — get, set и delete
    + Примеры
        + Memcashed
        + Redis (с натяжкой)
        + Riak
        
+ Документ-ориентированные базы данных
    + Это сильно усложненный вариант предыдущей категории. Эта добавленная сложность — она дает ещё и бонусы: теперь значения — это не какой-то непрозрачный текстовый блоб, с которым ничего нельзя делать, кроме того, что целиком прочитать или удалить, а теперь можно работать более тонко со значением. Если нам нужна только часть документа, можем ее прочитать или обновить только часть
    + Примеры
        + MongoDB 
        + CouchDB
        + ElasticSearch
    
+ Колоночные базы данных
    + Есть файл — в нем хранятся все поля данной колонки из всех N млрд. записей, хранятся все рядом. Соответственно, другая колонка хранится в другом файле. За счет этого они могут применять улучшенное сжатие за счет использования информации о типе данных колонки. Также это может ускорять запросы, если, нам, например, нужны 3 колонки из 300, то нам не обязательно грузить остальные 297.
    + Примеры
        + HBase
        + Cassandra
        + Vertica
        + ClickHouse
    
+ Графовые базы данных
    + Сила этих баз данных в том, что за счет своей специализации они могут эффективно выполнять всякие операции над графами, но также в силу той же специализации они не сильно распространены
    + Примеры
        + Neo4j
    
+ Мультимодельные базы данных
    + Это такие базы данных, в которые одновременно входит две или более категорий из предыдущих.
    + Примеры
        + FoundationDB
        + ArangoDB
        + OrientDB

